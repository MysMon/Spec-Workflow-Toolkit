# プランセルフレビューチェックリスト

`/spec-plan` フェーズ 4 の終了時に、最終プランをユーザーに提示する前にオーケストレーターが実行する軽量品質ゲート。エージェントは起動しない — コンテキスト予算を保持する。

## ロードタイミング

`/spec-plan` フェーズ 4 の終了時、仕様と設計ファイルが保存された後にこのスキルをロード。

## 前提条件

**チェックリスト実行前のファイルサイズチェック:**

このセルフレビューは以下の両方の条件が満たされる場合のみ適切:
1. 仕様ファイル ≤200 行
2. 設計ファイル ≤200 行

**いずれかのファイルが 200 行を超える場合:**
→ このチェックリストをスキップし、`--auto` フラグ付きで `/spec-review` に直接進む
→ 並列レビューエージェントの方が大きなドキュメントに適している

これは `subagent-contract` スキルで定義されたクイックルックアップ制限を尊重する。

## チェックリスト

オーケストレーターが両方の出力ファイルを読み、各項目を PASS または FLAG として確認する。

### 仕様チェックリスト

| # | チェック | 検証方法 |
|---|---------|---------|
| S1 | **受入基準が測定可能** | 各基準に具体的な条件があり、「うまく動くべき」でない |
| S2 | **エッジケースが列挙されている** | 少なくとも 3 つのエッジケースまたはエラーシナリオが定義 |
| S3 | **スコープ外が定義されている** | セクションが存在し少なくとも 1 つの除外が記載 |
| S4 | **曖昧な言葉がない** | "should"、"might"、"could"、"possibly" を検索 — 要件内にあればフラグ（根拠内は OK） |
| S5 | **セキュリティ要件がある** | 認証、認可、バリデーション、または「理由付きで N/A」 |
| S6 | **非機能要件がある** | パフォーマンス、スケーラビリティ、または「理由付きで N/A」 |

### 設計チェックリスト

| # | チェック | 検証方法 |
|---|---------|---------|
| D1 | **実装マップにファイルがある** | Create/Modify アクション付きで少なくとも 1 ファイルが記載 |
| D2 | **ビルドシーケンスがある** | 少なくとも 2 つの順序付きステップ |
| D3 | **トレードオフが文書化されている** | 少なくとも 1 つのトレードオフまたは却下された代替案 |
| D4 | **ファイル参照が妥当** | 参照されたファイルが存在する（Glob チェック）か「Create」としてマークされている |

### 一貫性チェックリスト

| # | チェック | 検証方法 |
|---|---------|---------|
| C1 | **仕様要件が設計でカバーされている** | 各仕様セクションが設計コンポーネントにマッピング |
| C2 | **設計が仕様と矛盾しない** | 仕様要件に違反する設計選択がない |
| C3 | **ビルドシーケンスが全コンポーネントをカバー** | 実装マップの各コンポーネントがビルドシーケンスに出現 |

## 出力形式

```markdown
## セルフレビュー結果

合格: [N]/13
フラグ: [N]

### フラグされた項目
- [S4] 曖昧な言葉: 要件 3.2 に "should" が含まれている
- [C1] 仕様セクション「エラーハンドリング」に対応する設計コンポーネントがない

### 評価
[ALL CLEAR / MINOR FLAGS / NEEDS ATTENTION]
```

## 結果に基づくアクション

| 結果 | アクション |
|------|----------|
| ALL CLEAR（フラグ 0 件） | プランをそのままユーザーに提示 |
| MINOR FLAGS（1-2 件のフラグ） | フラグを付記してプランを提示: 「セルフレビューで [N] 件の注意事項を検出: ...」 |
| NEEDS ATTENTION（3+ 件のフラグ） | 提示前にフラグされた項目を修正。仕様の問題は仕様を編集、設計の問題は設計を編集。その後チェックリストを 1 回再実行。 |

## ルール（L1 - ハード）

- NEVER: このチェックリストにサブエージェントを起動しない — 直接ファイル読み取りのみ使用
- ALWAYS: 最終プランをユーザーに提示する前にこれを実行
- NEVER: 項目をサイレントに自動修正しない — 常に何がフラグされたかを報告

## デフォルト（L2 - ソフト）

- NEEDS ATTENTION の項目は提示前に修正する（ただしユーザーに変更を通知）
- プラン提示にフラグされた項目を含め、ユーザーに認識してもらう
