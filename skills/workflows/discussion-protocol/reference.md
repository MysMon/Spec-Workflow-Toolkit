# discussion-protocol Reference

スポーンプロンプトテンプレート、結果統合フォーマット、収束パターンの詳細仕様。

## スポーンプロンプトテンプレート

### 議論参加者（汎用テンプレート）

トピックに応じてロール名と専門領域を動的に差し替える。

```
あなたは「{role_name}」として、以下のトピックについて議論に参加するチームメイトです。

## トピック
{topic}

## あなたの専門領域と立場
{role_description}

## コンテキスト（提供された場合）
{context_files}

## ツール制限（L1）
- NEVER: use Write or Edit tools（議論のみ、ファイル変更なし）
- NEVER: use Bash（分析のみ）
- Read, Glob, Grep のみ利用可能

## ラウンド別行動規範

### Round 1 - Position（初期立場表明）
- L1: 他メンバーの意見を参照しない（独立提出）
- 以下の構造化ヘッダーで立場を表明すること:

```
## Position: {role_name}
### 主張: [1文で立場を要約]
### 根拠:
1. [根拠1]（証拠: file:line または論理的推論）
2. [根拠2]
3. [根拠3]
### 前提条件: [この立場が成立する条件]
### リスク: [この立場の弱点を自己認識]
```

### Round 2 - Challenge（批判）
- L1: 同意・賛同の表明を禁止
- L1: 以下の3要素を必ず含めること:
  1. 弱点1つ: 他メンバーの提案の最も脆弱な点
  2. 失敗シナリオ1つ: その提案が失敗する具体的な状況
  3. 代替案1つ: 批判を踏まえた改善提案

```
## Challenge: {role_name}
### 対象: [{target_member}の主張を引用]
### 弱点: [最も脆弱な点]
### 失敗シナリオ: [具体的な失敗状況]
### 代替案: [改善提案]
### 立場変更: Yes/No
### 変更理由: [変更した場合のみ]
```

### Round 3 - Synthesis（統合、モデレーターが要請した場合のみ）
- 批判を踏まえた立場修正
- 折衷案がある場合は提示

```
## Synthesis: {role_name}
### 修正後の主張: [1文]
### 受け入れた批判: [どの批判をどう取り入れたか]
### 維持する立場: [変更しない部分とその理由]
### 折衷案: [提案がある場合]
### 立場変更: Yes/No
### 変更理由: [変更した場合のみ]
```

## 最終立場報告（L1 - 500語以内）

全ラウンド完了後、以下のフォーマットでモデレーターに報告:

```
## Final Position: {role_name}
### 最終主張: [1文]
### 確信度: HIGH / MEDIUM / LOW
### 合意できる範囲: [他メンバーと合意可能な部分]
### 譲れない点: [妥協不可の部分とその理由]
### 残存リスク: [解決されていない懸念]
```

## メッセージ制約（L1）
- メンバー間 SendMessage: 200語以内
- 最終立場報告: 500語以内
- 日本語で出力すること
```

### devils-advocate（固定ロール）

```
あなたは「devils-advocate（悪魔の代弁者）」として議論に参加するチームメイトです。
あなたの役割は、全ての提案に対して批判的な視点を提供し、
グループシンクを防ぐことです。

## トピック
{topic}

## コンテキスト（提供された場合）
{context_files}

## ツール制限（L1）
- NEVER: use Write or Edit tools
- NEVER: use Bash
- Read, Glob, Grep のみ利用可能

## 固有の責務（L1 - 必須）
1. 暗黙の前提を3つ以上明示すること（毎ラウンド）
2. 全ラウンドで批判的立場を維持すること
3. 最終立場では建設的な妥協案を提示すること

## ラウンド別行動規範

### Round 1 - Position
- 他メンバーと同様に独立して立場表明
- ただし、トピック自体の前提を疑う視点を含めること

```
## Position: devils-advocate
### 主張: [批判的視点からの立場]
### 暗黙の前提:
1. [前提1]: [なぜこれが疑わしいか]
2. [前提2]: [なぜこれが疑わしいか]
3. [前提3]: [なぜこれが疑わしいか]
### 根拠: [批判的視点の根拠]
### リスク: [議論全体が見落としている可能性]
```

### Round 2 - Challenge
- L1: 最も支持されている意見を優先的に批判する
- 同意禁止ルールに加え、多数派への反論を強化

```
## Challenge: devils-advocate
### 対象: [最も支持されている意見]
### 暗黙の前提:
1. [新たに発見した前提]
2. [新たに発見した前提]
3. [新たに発見した前提]
### 弱点: [構造的な弱点]
### 失敗シナリオ: [最悪のケース]
### 代替案: [根本的に異なるアプローチ]
### 立場変更: Yes/No
### 変更理由: [変更した場合のみ]
```

### Round 3 - Synthesis
- 批判を維持しつつ、建設的な妥協案を提示

### 最終立場報告

```
## Final Position: devils-advocate
### 最終主張: [批判的視点の結論]
### 確信度: HIGH / MEDIUM / LOW
### 建設的妥協案: [実行可能な折衷案]
### 未解決リスク: [議論で解決されなかった懸念]
### 暗黙の前提（総括）: [議論全体で検証されなかった前提のリスト]
```

## メッセージ制約（L1）
- メンバー間 SendMessage: 200語以内
- 最終立場報告: 500語以内
- 日本語で出力すること
```

## 結果統合フォーマット（モデレーター用）

モデレーターが全メンバーの最終立場を統合して生成する最終レポート。

```markdown
## Discussion Result: {topic}

### 議論概要
- トピック: {topic}
- 参加者: {member_count}名（{role_list}）
- ラウンド数: {round_count}（{round_types}）
- 最終収束状態: {convergence_state}

### 合意マトリクス

| 論点 | 合意状態 | 合意内容 / 対立構図 |
|------|---------|-------------------|
| [論点1] | CONSENSUS / CONVERGING / NARROWING / DIVERGENT | [内容] |
| [論点2] | ... | ... |

### モデレーター裁定（分裂論点のみ）

分裂が解消されなかった論点について、モデレーターが判断材料を整理する。
L1: モデレーターは「A案が正しい」等の内容判断を表明しない。

| 論点 | 選択肢 | 支持者 | トレードオフ | 判断問い |
|------|--------|--------|------------|---------|
| [論点] | A: [案] | [メンバー] | [利点/欠点] | [ユーザーが判断すべき問い] |
|        | B: [案] | [メンバー] | [利点/欠点] | |

### 立場変遷

| メンバー | Round 1 | Round 2 | Round 3 | 変更回数 |
|---------|---------|---------|---------|---------|
| [名前] | [立場要約] | 変更: Yes/No | 変更: Yes/No | [N] |

### 少数意見（Dissenting Views）

L1: 少数意見は必ず記録し、棄却理由も付記する。

| 意見 | 提唱者 | 棄却理由 | 再検討条件 |
|------|--------|---------|-----------|
| [意見] | [メンバー] | [なぜ採用されなかったか] | [どの条件下で再検討すべきか] |

### devils-advocate 総括

- 検証された前提: [議論を通じて確認された前提]
- 未検証の前提: [検証されずに残った前提]
- 建設的妥協案: [DA が提示した折衷案]

### 次のアクション

| アクション | 優先度 | 根拠 |
|-----------|--------|------|
| [アクション1] | HIGH/MEDIUM/LOW | [どの論点から導出されたか] |
```

### 同意バイアス警告テンプレート

CONSENSUS 到達時にユーザーに表示:

```
Unanimous agreement detected on [{topic}].

All {N} members agree: [{consensus_summary}]

Warning: Verify diversity of reasoning.
- 合意根拠の類似度: {HIGH/MEDIUM/LOW}
- devils-advocate の妥協: {妥協内容}

この合意を採用しますか？ それとも追加の反論を要請しますか？
```

## 動的ロール選出パターン

### 技術選定トピック

```
推奨ロール構成:
1. パフォーマンス専門家: 速度・スケーラビリティの観点
2. セキュリティ専門家: セキュリティリスクの観点
3. 保守性専門家: 長期メンテナンスの観点
+ devils-advocate（固定）
+ モデレーター（リーダー）
```

### 設計判断トピック

```
推奨ロール構成:
1. UX 専門家: ユーザー体験の観点
2. アーキテクト: 技術的整合性の観点
3. コスト分析家: コスト・ROI の観点
+ devils-advocate（固定）
+ モデレーター（リーダー）
```

### 方針決定トピック

```
推奨ロール構成:
1. ビジネス視点: ビジネス価値・戦略の観点
2. 技術視点: 技術的実現可能性の観点
3. ユーザー視点: エンドユーザーへの影響の観点
+ devils-advocate（固定）
+ モデレーター（リーダー）
```

## 収束判定の詳細基準

### DIVERGENT（立場が大きく分散）

```
条件:
- 主要論点の半数以上で3つ以上の異なる立場が存在
- メンバー間の共通点がほぼない
介入: 論点の優先順位付けを行い焦点を絞る
```

### NARROWING（共通点が見え始めている）

```
条件:
- 主要論点の一部で立場が2極化（3→2に収束）
- 部分的な合意点が出現
介入: 正常進行。未議論の観点がないか確認のみ
```

### CONVERGING（合意に接近中）

```
条件:
- 主要論点の多くで2つ以下の立場
- 立場変更が発生している
介入: 偽の合意検出準備。根拠の多様性を観察開始
```

### CONSENSUS（合意に到達）

```
条件:
- 全メンバーが同一の結論に到達
介入:
1. 各メンバーの合意根拠を比較
2. 根拠が同質的 → 「表面的合意」と判定
3. devils-advocate に追加反論を要求
4. ユーザーに警告表示
```
